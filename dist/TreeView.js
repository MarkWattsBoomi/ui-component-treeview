!function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var n={};e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}(n(1))},function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=n(2);n(3);var a=function(t){function e(e){var n=t.call(this,e)||this;n.componentId="",n.flowKey="",n.attributes=new Map,n.childNodes=[],n.selectedItem=null,n.componentId=e.id,n.flowKey=e.flowKey;var r=manywho.model.getComponent(n.props.id,n.props.flowKey);if(r.attributes)for(var o in r.attributes)n.attributes.set(o,r.attributes[o]);return n}return r(e,t),e.prototype.componentDidMount=function(){this.forceUpdate()},e.prototype.selectItem=function(t){this.selectedItem=t;for(var e in this.refs)this.refs[e].deselectAllChildren()},e.prototype.getSelectedItem=function(){return this.selectedItem},e.prototype.getAttribute=function(t){return this.attributes.has(t)?this.attributes.get(t):null},e.prototype.render=function(){var t=manywho.model.getComponent(this.props.id,this.props.flowKey),e=(manywho.state.getComponent(this.props.id,this.props.flowKey),new Map);t.width&&t.width>0&&e.set("width",t.width+"px"),t.height&&t.height>0&&e.set("height",t.height+"px");var n=this;return this.childNodes=t.objectData.map(function(t,e){var r=manywho.utils.getObjectDataProperty(t.properties,n.getAttribute("parentKeyAttribute")).contentValue;return o.createElement(i,{ref:"G_"+r,parent:n,group:t})}),o.createElement("div",{className:"tree-view",style:e},o.createElement("ul",{className:"tree-root"},this.childNodes))},e}(o.Component),i=function(t){function e(e){var n=t.call(this,e)||this;return n.childNodes=[],n.expanded=!1,n.parent=null,n.queueGroup=null,n.parent=e.parent,n.queueGroup=e.group,n.deselectAllChildren=n.deselectAllChildren.bind(n),n.toggleExpand=n.toggleExpand.bind(n),n.expanded="true"===n.parent.getAttribute("showExpanded"),n}return r(e,t),e.prototype.componentDidMount=function(){},e.prototype.componentWillUnmount=function(){},e.prototype.toggleExpand=function(){this.expanded=!this.expanded,this.forceUpdate()},e.prototype.deselectAllChildren=function(){for(var t in this.refs)this.refs[t].deselect()},e.prototype.render=function(){var t=manywho.state.getComponent(this.parent.componentId,this.parent.flowKey);manywho.model.getComponent(this.parent.componentId,this.parent.flowKey);if(this.childNodes=[],t.loading)return null;var e=manywho.utils.getObjectDataProperty(this.queueGroup.properties,this.parent.getAttribute("parentLabelAttribute")).contentValue,n=manywho.utils.getObjectDataProperty(this.queueGroup.properties,this.parent.getAttribute("parentChildArrayAttribute")).objectData,r=this;n&&(this.childNodes=n.map(function(t,e){var n=manywho.utils.getObjectDataProperty(t.properties,r.parent.getAttribute("parentKeyAttribute")).contentValue;return o.createElement(p,{ref:"Q_"+n,parent:r,queue:t})}));var a=manywho.utils.getObjectDataProperty(this.queueGroup.properties,this.parent.getAttribute("parentIconAttribute")).contentValue;a&&0!==a.length||(a=this.parent.getAttribute("parentDefaultIcon")||"envelope");var i=null;if("true"===this.parent.getAttribute("isCollapsible")&&n.length>0){var s="";s=!0===this.expanded?this.parent.getAttribute("contractIcon")||"minus-sign":this.parent.getAttribute("expandIcon")||"plus-sign",i=o.createElement("span",{className:"glyphicon glyphicon-"+s,style:{"padding-right":"10px"},onClick:this.toggleExpand})}var l=null;return!0===this.expanded&&(l=o.createElement("ul",{className:"tree-leaf"},this.childNodes)),o.createElement("li",{className:"tree-root-item"},i,o.createElement("span",{className:"glyphicon glyphicon-"+a}),o.createElement("span",{className:"queue-group-label"},e),l)},e}(o.Component),p=function(t){function e(e){var n=t.call(this,e)||this;n.selected=!1,n.parent=null,n.queue=null,n.parent=e.parent,n.queue=e.queue,n.select=n.select.bind(n),n.deselect=n.deselect.bind(n);var r=n.parent.parent.getSelectedItem();return n.selected=manywho.utils.getObjectDataProperty(n.queue.properties,n.props.parent.props.parent.getAttribute("childKeyAttribute")).contentValue===r,n}return r(e,t),e.prototype.select=function(){this.parent.parent.selectItem(manywho.utils.getObjectDataProperty(this.queue.properties,this.parent.parent.getAttribute("childKeyAttribute")).contentValue),this.selected=!0;var t=JSON.parse(JSON.stringify(this.queue));t.isSelected=!0;var e={objectData:[t]};manywho.state.setComponent(this.parent.parent.componentId,e,this.parent.parent.flowKey,!0);var n=manywho.model.getOutcome(this.parent.parent.getAttribute("outcomeIdForSelect"),this.parent.parent.flowKey);manywho.component.onOutcome(n,null,this.parent.parent.flowKey)},e.prototype.deselect=function(){this.selected=!1},e.prototype.componentDidMount=function(){var t=null,e=manywho.model.getComponent(this.parent.parent.componentId,this.parent.parent.flowKey),n=manywho.state.getComponent(this.parent.parent.componentId,this.parent.parent.flowKey)||{};if(n&&n.objectData&&n.objectData[0]&&n.objectData[0].properties?t=n.objectData[0]:e&&e.objectData&&e.objectData[0]&&(t=e.objectData[0]),t){manywho.utils.getObjectDataProperty(this.queue.properties,this.parent.parent.getAttribute("childKeyAttribute")).contentValue===manywho.utils.getObjectDataProperty(t.properties,this.parent.parent.getAttribute("childKeyAttribute")).contentValue&&(this.selected=!0)}},e.prototype.render=function(){var t=manywho.state.getComponent(this.parent.parent.componentId,this.parent.parent.flowKey);manywho.model.getComponent(this.parent.parent.componentId,this.parent.parent.flowKey);if(t.loading)return null;var e=(manywho.utils.getObjectDataProperty(this.queue.properties,this.parent.parent.getAttribute("childKeyAttribute")).contentValue,manywho.utils.getObjectDataProperty(this.queue.properties,this.parent.parent.getAttribute("childLabelAttribute")).contentValue),n=manywho.utils.getObjectDataProperty(this.queue.properties,this.parent.parent.getAttribute("childSubLabelAttribute")).contentValue,r=manywho.utils.getObjectDataProperty(this.queue.properties,this.parent.parent.getAttribute("childIconAttribute")).contentValue;r&&0!==r.length||(r=this.parent.parent.getAttribute("childDefaultIcon")||"tasks");var a=this.selected?"tree-leaf tree-leaf-selected":"tree-leaf";return o.createElement("li",{className:a,onClick:this.select},o.createElement("span",{className:"glyphicon glyphicon-"+r}),o.createElement("span",{className:"queue-label"},e),o.createElement("span",{className:"queue-count"},"("+n+")"))},e}(o.Component);manywho.component.register("TreeView",a),e.default=a},function(t,e){t.exports=React},function(t,e){}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vVHJlZVZpZXcuanMiLCJ3ZWJwYWNrOi8vL3dlYnBhY2svYm9vdHN0cmFwIDY1OGFiN2I0YWExNzRjZDhkMTc1Iiwid2VicGFjazovLy8uL3NyYy9pbmRleC50c3giLCJ3ZWJwYWNrOi8vLy4vc3JjL1RyZWVWaWV3LnRzeCIsIndlYnBhY2s6Ly8vZXh0ZXJuYWwgXCJSZWFjdFwiIl0sIm5hbWVzIjpbIm1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJpbnN0YWxsZWRNb2R1bGVzIiwiZXhwb3J0cyIsIm1vZHVsZSIsImkiLCJsIiwiY2FsbCIsIm0iLCJjIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJjb25maWd1cmFibGUiLCJlbnVtZXJhYmxlIiwiZ2V0IiwibiIsIl9fZXNNb2R1bGUiLCJvYmplY3QiLCJwcm9wZXJ0eSIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwicCIsInMiLCJ2YWx1ZSIsIl9fZXh0ZW5kcyIsInRoaXMiLCJleHRlbmRTdGF0aWNzIiwic2V0UHJvdG90eXBlT2YiLCJfX3Byb3RvX18iLCJBcnJheSIsImIiLCJfXyIsImNvbnN0cnVjdG9yIiwiY3JlYXRlIiwiUmVhY3QiLCJUcmVlVmlldyIsIl9zdXBlciIsInByb3BzIiwiX3RoaXMiLCJjb21wb25lbnRJZCIsImZsb3dLZXkiLCJhdHRyaWJ1dGVzIiwiTWFwIiwiY2hpbGROb2RlcyIsInNlbGVjdGVkSXRlbSIsImlkIiwiZmxvd01vZGVsIiwibWFueXdobyIsIm1vZGVsIiwiZ2V0Q29tcG9uZW50Iiwia2V5Iiwic2V0IiwiY29tcG9uZW50RGlkTW91bnQiLCJmb3JjZVVwZGF0ZSIsInNlbGVjdEl0ZW0iLCJyZWZzIiwiZGVzZWxlY3RBbGxDaGlsZHJlbiIsImdldFNlbGVjdGVkSXRlbSIsImdldEF0dHJpYnV0ZSIsImF0dHJpYnV0ZU5hbWUiLCJoYXMiLCJyZW5kZXIiLCJzdHlsZXMiLCJzdGF0ZSIsIndpZHRoIiwiaGVpZ2h0Iiwic2VsZiIsIm9iamVjdERhdGEiLCJtYXAiLCJncm91cCIsImluZGV4IiwiZ3JvdXBJZCIsInV0aWxzIiwiZ2V0T2JqZWN0RGF0YVByb3BlcnR5IiwicHJvcGVydGllcyIsImNvbnRlbnRWYWx1ZSIsImNyZWF0ZUVsZW1lbnQiLCJUcmVlUGFyZW50Tm9kZSIsInJlZiIsInBhcmVudCIsImNsYXNzTmFtZSIsInN0eWxlIiwiQ29tcG9uZW50IiwiZXhwYW5kZWQiLCJxdWV1ZUdyb3VwIiwiYmluZCIsInRvZ2dsZUV4cGFuZCIsImNvbXBvbmVudFdpbGxVbm1vdW50IiwiZGVzZWxlY3QiLCJmbG93U3RhdGUiLCJsb2FkaW5nIiwiZ3JvdXBOYW1lIiwicXVldWVzIiwicXVldWUiLCJxdWV1ZUlkIiwiVHJlZUNoaWxkTm9kZSIsImljb24iLCJsZW5ndGgiLCJleHBJY29uIiwiZXhwYW5kSWNvbiIsInBhZGRpbmctcmlnaHQiLCJvbkNsaWNrIiwicXVldWVJdGVtcyIsInNlbGVjdGVkIiwic2VsZWN0Iiwic2VsZWN0ZWRRdWV1ZUlkIiwiSlNPTiIsInBhcnNlIiwic3RyaW5naWZ5IiwiaXNTZWxlY3RlZCIsIm5ld1N0YXRlIiwic2V0Q29tcG9uZW50Iiwib3V0Y29tZSIsImdldE91dGNvbWUiLCJjb21wb25lbnQiLCJvbk91dGNvbWUiLCJxdWV1ZU5hbWUiLCJzdWJMYWJlbCIsInJlZ2lzdGVyIiwiZGVmYXVsdCJdLCJtYXBwaW5ncyI6IkNBQVMsU0FBVUEsR0NJbkIsUUFBQUMsR0FBQUMsR0FHQSxHQUFBQyxFQUFBRCxHQUNBLE1BQUFDLEdBQUFELEdBQUFFLE9BR0EsSUFBQUMsR0FBQUYsRUFBQUQsSUFDQUksRUFBQUosRUFDQUssR0FBQSxFQUNBSCxXQVVBLE9BTkFKLEdBQUFFLEdBQUFNLEtBQUFILEVBQUFELFFBQUFDLElBQUFELFFBQUFILEdBR0FJLEVBQUFFLEdBQUEsRUFHQUYsRUFBQUQsUUF2QkEsR0FBQUQsS0E0QkFGLEdBQUFRLEVBQUFULEVB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RUFBT2pELFFBQVF5QixNQUFNQyxzQkFBc0JoRCxLQUFLb0UsTUFBTW5CLFdBQVlqRCxLQUFLc0QsT0FBT0EsT0FBT3JCLGFBQWEsdUJBQXVCaUIsWUFFekhxQixJQUFzQixJQUFkQSxFQUFLQyxTQUVoQkQsRUFBTXZFLEtBQUtzRCxPQUFPQSxPQUFPckIsYUFBYSxxQkFBdUIsUUFHckQsSUFBSXNCLEdBQVl2RCxLQUFLOEUsU0FBVywrQkFBaUMsV0FLakUsT0FBT3JFLEdBQUEwQyxjQUFBLE1BQUlJLFVBQVlBLEVBQVdxQixRQUFTNUUsS0FBSytFLFFBQzVDdEUsRUFBQTBDLGNBQUEsUUFBTUksVUFBVyx1QkFBeUJnQixJQUMxQzlELEVBQUEwQyxjQUFBLFFBQU1JLFVBQVcsZUFBZ0JvQyxHQUNqQ2xGLEVBQUEwQyxjQUFBLFFBQU1JLFVBQVcsZUFBZ0IsSUFBTXFDLEVBQVcsT0FNbEV0QixHQS9INEI3RCxFQUFNZ0QsVUFpSWxDbkMsU0FBUW1FLFVBQVVJLFNBQVMsV0FBWW5GLEdBRXZDcEMsRUFBQXdILFFBQWVwRixHSHZCVCxTQUFVbkMsRUFBUUQsR0k1VXhCQyxFQUFBRCxRQUFBbUMsT0prVk0sU0FBVWxDLEVBQVFEIiwiZmlsZSI6IlRyZWVWaWV3LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqKioqKi8gKGZ1bmN0aW9uKG1vZHVsZXMpIHsgLy8gd2VicGFja0Jvb3RzdHJhcFxuLyoqKioqKi8gXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4vKioqKioqLyBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG4vKioqKioqL1xuLyoqKioqKi8gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuLyoqKioqKi8gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG4vKioqKioqL1xuLyoqKioqKi8gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuLyoqKioqKi8gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4vKioqKioqLyBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbi8qKioqKiovIFx0XHR9XG4vKioqKioqLyBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbi8qKioqKiovIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4vKioqKioqLyBcdFx0XHRpOiBtb2R1bGVJZCxcbi8qKioqKiovIFx0XHRcdGw6IGZhbHNlLFxuLyoqKioqKi8gXHRcdFx0ZXhwb3J0czoge31cbi8qKioqKiovIFx0XHR9O1xuLyoqKioqKi9cbi8qKioqKiovIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbi8qKioqKiovIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcbi8qKioqKiovXG4vKioqKioqLyBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuLyoqKioqKi8gXHRcdG1vZHVsZS5sID0gdHJ1ZTtcbi8qKioqKiovXG4vKioqKioqLyBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbi8qKioqKiovIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4vKioqKioqLyBcdH1cbi8qKioqKiovXG4vKioqKioqL1xuLyoqKioqKi8gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuLyoqKioqKi8gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuLyoqKioqKi9cbi8qKioqKiovIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbi8qKioqKiovIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcbi8qKioqKiovXG4vKioqKioqLyBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuLyoqKioqKi8gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbi8qKioqKiovIFx0XHRpZighX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIG5hbWUpKSB7XG4vKioqKioqLyBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwge1xuLyoqKioqKi8gXHRcdFx0XHRjb25maWd1cmFibGU6IGZhbHNlLFxuLyoqKioqKi8gXHRcdFx0XHRlbnVtZXJhYmxlOiB0cnVlLFxuLyoqKioqKi8gXHRcdFx0XHRnZXQ6IGdldHRlclxuLyoqKioqKi8gXHRcdFx0fSk7XG4vKioqKioqLyBcdFx0fVxuLyoqKioqKi8gXHR9O1xuLyoqKioqKi9cbi8qKioqKiovIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbi8qKioqKiovIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5uID0gZnVuY3Rpb24obW9kdWxlKSB7XG4vKioqKioqLyBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4vKioqKioqLyBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuLyoqKioqKi8gXHRcdFx0ZnVuY3Rpb24gZ2V0TW9kdWxlRXhwb3J0cygpIHsgcmV0dXJuIG1vZHVsZTsgfTtcbi8qKioqKiovIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4vKioqKioqLyBcdFx0cmV0dXJuIGdldHRlcjtcbi8qKioqKiovIFx0fTtcbi8qKioqKiovXG4vKioqKioqLyBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuLyoqKioqKi8gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSBmdW5jdGlvbihvYmplY3QsIHByb3BlcnR5KSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSk7IH07XG4vKioqKioqL1xuLyoqKioqKi8gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuLyoqKioqKi8gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiO1xuLyoqKioqKi9cbi8qKioqKiovIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4vKioqKioqLyBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDApO1xuLyoqKioqKi8gfSlcbi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG4vKioqKioqLyAoW1xuLyogMCAqL1xuLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykge1xuXG5cInVzZSBzdHJpY3RcIjtcblxyXG5mdW5jdGlvbiBfX2V4cG9ydChtKSB7XHJcbiAgICBmb3IgKHZhciBwIGluIG0pIGlmICghZXhwb3J0cy5oYXNPd25Qcm9wZXJ0eShwKSkgZXhwb3J0c1twXSA9IG1bcF07XHJcbn1cclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG5fX2V4cG9ydChfX3dlYnBhY2tfcmVxdWlyZV9fKDEpKTtcclxuXG5cbi8qKiovIH0pLFxuLyogMSAqL1xuLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykge1xuXG5cInVzZSBzdHJpY3RcIjtcblxyXG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxyXG4gICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcclxuICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcclxuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xyXG4gICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XHJcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XHJcbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xyXG4gICAgfTtcclxufSkoKTtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG52YXIgUmVhY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIpO1xyXG5fX3dlYnBhY2tfcmVxdWlyZV9fKDMpO1xyXG52YXIgVHJlZVZpZXcgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoVHJlZVZpZXcsIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBUcmVlVmlldyhwcm9wcykge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIHByb3BzKSB8fCB0aGlzO1xyXG4gICAgICAgIF90aGlzLmNvbXBvbmVudElkID0gXCJcIjtcclxuICAgICAgICBfdGhpcy5mbG93S2V5ID0gXCJcIjtcclxuICAgICAgICBfdGhpcy5hdHRyaWJ1dGVzID0gbmV3IE1hcCgpO1xyXG4gICAgICAgIF90aGlzLmNoaWxkTm9kZXMgPSBbXTtcclxuICAgICAgICBfdGhpcy5zZWxlY3RlZEl0ZW0gPSBudWxsO1xyXG4gICAgICAgIF90aGlzLmNvbXBvbmVudElkID0gcHJvcHMuaWQ7XHJcbiAgICAgICAgX3RoaXMuZmxvd0tleSA9IHByb3BzLmZsb3dLZXk7XHJcbiAgICAgICAgLy9wdXNoIGF0dHJpYnV0ZXMgaW50byBrZXllZCBtYXAgXHJcbiAgICAgICAgdmFyIGZsb3dNb2RlbCA9IG1hbnl3aG8ubW9kZWwuZ2V0Q29tcG9uZW50KF90aGlzLnByb3BzLmlkLCBfdGhpcy5wcm9wcy5mbG93S2V5KTtcclxuICAgICAgICBpZiAoZmxvd01vZGVsLmF0dHJpYnV0ZXMpIHtcclxuICAgICAgICAgICAgZm9yICh2YXIga2V5IGluIGZsb3dNb2RlbC5hdHRyaWJ1dGVzKSB7XHJcbiAgICAgICAgICAgICAgICBfdGhpcy5hdHRyaWJ1dGVzLnNldChrZXksIGZsb3dNb2RlbC5hdHRyaWJ1dGVzW2tleV0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBfdGhpcztcclxuICAgIH1cclxuICAgIFRyZWVWaWV3LnByb3RvdHlwZS5jb21wb25lbnREaWRNb3VudCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aGlzLmZvcmNlVXBkYXRlKCk7XHJcbiAgICB9O1xyXG4gICAgLy90aGlzIHdpbGwgYmUgdHJpZ2dlcmVkIGlmIGFueSBsZWFmIGlzIHNlbGVjdGVkXHJcbiAgICBUcmVlVmlldy5wcm90b3R5cGUuc2VsZWN0SXRlbSA9IGZ1bmN0aW9uIChpZCkge1xyXG4gICAgICAgIHRoaXMuc2VsZWN0ZWRJdGVtID0gaWQ7XHJcbiAgICAgICAgLy9sb29wIHRocm91Z2ggY2hpbGRyZW4gdGVsbGluZyBlYWNoIHRvIGRlc2VsZWN0IHRoZWlyIGNoaWxkcmVuXHJcbiAgICAgICAgZm9yICh2YXIga2V5IGluIHRoaXMucmVmcykge1xyXG4gICAgICAgICAgICB0aGlzLnJlZnNba2V5XS5kZXNlbGVjdEFsbENoaWxkcmVuKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFRyZWVWaWV3LnByb3RvdHlwZS5nZXRTZWxlY3RlZEl0ZW0gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0ZWRJdGVtO1xyXG4gICAgfTtcclxuICAgIFRyZWVWaWV3LnByb3RvdHlwZS5nZXRBdHRyaWJ1dGUgPSBmdW5jdGlvbiAoYXR0cmlidXRlTmFtZSkge1xyXG4gICAgICAgIGlmICh0aGlzLmF0dHJpYnV0ZXMuaGFzKGF0dHJpYnV0ZU5hbWUpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmF0dHJpYnV0ZXMuZ2V0KGF0dHJpYnV0ZU5hbWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFRyZWVWaWV3LnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGZsb3dNb2RlbCA9IG1hbnl3aG8ubW9kZWwuZ2V0Q29tcG9uZW50KHRoaXMucHJvcHMuaWQsIHRoaXMucHJvcHMuZmxvd0tleSk7XHJcbiAgICAgICAgdmFyIGZsb3dTdGF0ZSA9IG1hbnl3aG8uc3RhdGUuZ2V0Q29tcG9uZW50KHRoaXMucHJvcHMuaWQsIHRoaXMucHJvcHMuZmxvd0tleSk7XHJcbiAgICAgICAgdmFyIHN0eWxlcyA9IG5ldyBNYXAoKTtcclxuICAgICAgICBpZiAoZmxvd01vZGVsLndpZHRoICYmIGZsb3dNb2RlbC53aWR0aCA+IDApIHtcclxuICAgICAgICAgICAgc3R5bGVzLnNldChcIndpZHRoXCIsIGZsb3dNb2RlbC53aWR0aCArIFwicHhcIik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChmbG93TW9kZWwuaGVpZ2h0ICYmIGZsb3dNb2RlbC5oZWlnaHQgPiAwKSB7XHJcbiAgICAgICAgICAgIHN0eWxlcy5zZXQoXCJoZWlnaHRcIiwgZmxvd01vZGVsLmhlaWdodCArIFwicHhcIik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vY3JlYXRlIGFuIGFycmF5IG9mIFRyZWVQYXJlbnROb2RlIGNsYXNzZXMgZm9yIHRoZSBkYXRhXHJcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gICAgICAgIHRoaXMuY2hpbGROb2RlcyA9IGZsb3dNb2RlbC5vYmplY3REYXRhLm1hcChmdW5jdGlvbiAoZ3JvdXAsIGluZGV4KSB7XHJcbiAgICAgICAgICAgIHZhciBncm91cElkID0gbWFueXdoby51dGlscy5nZXRPYmplY3REYXRhUHJvcGVydHkoZ3JvdXAucHJvcGVydGllcywgc2VsZi5nZXRBdHRyaWJ1dGUoXCJwYXJlbnRLZXlBdHRyaWJ1dGVcIikpLmNvbnRlbnRWYWx1ZTtcclxuICAgICAgICAgICAgcmV0dXJuIChSZWFjdC5jcmVhdGVFbGVtZW50KFRyZWVQYXJlbnROb2RlLCB7IHJlZjogXCJHX1wiICsgZ3JvdXBJZCwgcGFyZW50OiBzZWxmLCBncm91cDogZ3JvdXAgfSkpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiBSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcInRyZWUtdmlld1wiLCBzdHlsZTogc3R5bGVzIH0sXHJcbiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJ1bFwiLCB7IGNsYXNzTmFtZTogXCJ0cmVlLXJvb3RcIiB9LCB0aGlzLmNoaWxkTm9kZXMpKTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gVHJlZVZpZXc7XHJcbn0oUmVhY3QuQ29tcG9uZW50KSk7XHJcbnZhciBUcmVlUGFyZW50Tm9kZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIF9fZXh0ZW5kcyhUcmVlUGFyZW50Tm9kZSwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIFRyZWVQYXJlbnROb2RlKHByb3BzKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgcHJvcHMpIHx8IHRoaXM7XHJcbiAgICAgICAgX3RoaXMuY2hpbGROb2RlcyA9IFtdO1xyXG4gICAgICAgIF90aGlzLmV4cGFuZGVkID0gZmFsc2U7XHJcbiAgICAgICAgX3RoaXMucGFyZW50ID0gbnVsbDtcclxuICAgICAgICBfdGhpcy5xdWV1ZUdyb3VwID0gbnVsbDtcclxuICAgICAgICBfdGhpcy5wYXJlbnQgPSBwcm9wcy5wYXJlbnQ7XHJcbiAgICAgICAgX3RoaXMucXVldWVHcm91cCA9IHByb3BzLmdyb3VwO1xyXG4gICAgICAgIF90aGlzLmRlc2VsZWN0QWxsQ2hpbGRyZW4gPSBfdGhpcy5kZXNlbGVjdEFsbENoaWxkcmVuLmJpbmQoX3RoaXMpO1xyXG4gICAgICAgIF90aGlzLnRvZ2dsZUV4cGFuZCA9IF90aGlzLnRvZ2dsZUV4cGFuZC5iaW5kKF90aGlzKTtcclxuICAgICAgICAvL3NldCBkZWZhdWx0IGV4cGFuZGVkXHJcbiAgICAgICAgX3RoaXMuZXhwYW5kZWQgPSBfdGhpcy5wYXJlbnQuZ2V0QXR0cmlidXRlKFwic2hvd0V4cGFuZGVkXCIpID09PSBcInRydWVcIiA/IHRydWUgOiBmYWxzZTtcclxuICAgICAgICByZXR1cm4gX3RoaXM7XHJcbiAgICB9XHJcbiAgICBUcmVlUGFyZW50Tm9kZS5wcm90b3R5cGUuY29tcG9uZW50RGlkTW91bnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgLy8gdGhpcy5wcm9wcy5vblJlZih0aGlzKVxyXG4gICAgfTtcclxuICAgIFRyZWVQYXJlbnROb2RlLnByb3RvdHlwZS5jb21wb25lbnRXaWxsVW5tb3VudCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAvLyB0aGlzLnByb3BzLm9uUmVmKHVuZGVmaW5lZClcclxuICAgIH07XHJcbiAgICBUcmVlUGFyZW50Tm9kZS5wcm90b3R5cGUudG9nZ2xlRXhwYW5kID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHRoaXMuZXhwYW5kZWQgPSAhdGhpcy5leHBhbmRlZDtcclxuICAgICAgICB0aGlzLmZvcmNlVXBkYXRlKCk7XHJcbiAgICB9O1xyXG4gICAgVHJlZVBhcmVudE5vZGUucHJvdG90eXBlLmRlc2VsZWN0QWxsQ2hpbGRyZW4gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgZm9yICh2YXIga2V5IGluIHRoaXMucmVmcykge1xyXG4gICAgICAgICAgICB0aGlzLnJlZnNba2V5XS5kZXNlbGVjdCgpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBUcmVlUGFyZW50Tm9kZS5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBmbG93U3RhdGUgPSBtYW55d2hvLnN0YXRlLmdldENvbXBvbmVudCh0aGlzLnBhcmVudC5jb21wb25lbnRJZCwgdGhpcy5wYXJlbnQuZmxvd0tleSk7XHJcbiAgICAgICAgdmFyIGZsb3dNb2RlbCA9IG1hbnl3aG8ubW9kZWwuZ2V0Q29tcG9uZW50KHRoaXMucGFyZW50LmNvbXBvbmVudElkLCB0aGlzLnBhcmVudC5mbG93S2V5KTtcclxuICAgICAgICB2YXIgaXRlbXMgPSBbXTtcclxuICAgICAgICB2YXIgd29ya1F1ZXVlcyA9IFtdO1xyXG4gICAgICAgIHRoaXMuY2hpbGROb2RlcyA9IFtdO1xyXG4gICAgICAgIGlmIChmbG93U3RhdGUubG9hZGluZykge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIC8vZ2V0IGdyb3VwIG5hbWVcclxuICAgICAgICAgICAgdmFyIGdyb3VwTmFtZSA9IG1hbnl3aG8udXRpbHMuZ2V0T2JqZWN0RGF0YVByb3BlcnR5KHRoaXMucXVldWVHcm91cC5wcm9wZXJ0aWVzLCB0aGlzLnBhcmVudC5nZXRBdHRyaWJ1dGUoXCJwYXJlbnRMYWJlbEF0dHJpYnV0ZVwiKSkuY29udGVudFZhbHVlO1xyXG4gICAgICAgICAgICAvL2dldCBxdWV1ZXNcclxuICAgICAgICAgICAgdmFyIHF1ZXVlcyA9IG1hbnl3aG8udXRpbHMuZ2V0T2JqZWN0RGF0YVByb3BlcnR5KHRoaXMucXVldWVHcm91cC5wcm9wZXJ0aWVzLCB0aGlzLnBhcmVudC5nZXRBdHRyaWJ1dGUoXCJwYXJlbnRDaGlsZEFycmF5QXR0cmlidXRlXCIpKS5vYmplY3REYXRhO1xyXG4gICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgICAgICAgICAgIGlmIChxdWV1ZXMpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2hpbGROb2RlcyA9IHF1ZXVlcy5tYXAoZnVuY3Rpb24gKHF1ZXVlLCBpbmRleCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBxdWV1ZUlkID0gbWFueXdoby51dGlscy5nZXRPYmplY3REYXRhUHJvcGVydHkocXVldWUucHJvcGVydGllcywgc2VsZi5wYXJlbnQuZ2V0QXR0cmlidXRlKFwicGFyZW50S2V5QXR0cmlidXRlXCIpKS5jb250ZW50VmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChSZWFjdC5jcmVhdGVFbGVtZW50KFRyZWVDaGlsZE5vZGUsIHsgcmVmOiBcIlFfXCIgKyBxdWV1ZUlkLCBwYXJlbnQ6IHNlbGYsIHF1ZXVlOiBxdWV1ZSB9KSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgaWNvbiA9IG1hbnl3aG8udXRpbHMuZ2V0T2JqZWN0RGF0YVByb3BlcnR5KHRoaXMucXVldWVHcm91cC5wcm9wZXJ0aWVzLCB0aGlzLnBhcmVudC5nZXRBdHRyaWJ1dGUoXCJwYXJlbnRJY29uQXR0cmlidXRlXCIpKS5jb250ZW50VmFsdWU7XHJcbiAgICAgICAgICAgIGlmICghaWNvbiB8fCBpY29uLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgaWNvbiA9IHRoaXMucGFyZW50LmdldEF0dHJpYnV0ZShcInBhcmVudERlZmF1bHRJY29uXCIpIHx8IFwiZW52ZWxvcGVcIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvL25lZWQgdG8ga25vdyBob3cgbWFueSBjaGlsZCBxdWV1ZXMgYXJlIGluIGdyb3VwXHJcbiAgICAgICAgICAgIHZhciBleHBJY29uID0gbnVsbDtcclxuICAgICAgICAgICAgaWYgKHRoaXMucGFyZW50LmdldEF0dHJpYnV0ZShcImlzQ29sbGFwc2libGVcIikgPT09IFwidHJ1ZVwiICYmIHF1ZXVlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZXhwYW5kSWNvbiA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5leHBhbmRlZCA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGV4cGFuZEljb24gPSB0aGlzLnBhcmVudC5nZXRBdHRyaWJ1dGUoXCJjb250cmFjdEljb25cIikgfHwgXCJtaW51cy1zaWduXCI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBleHBhbmRJY29uID0gdGhpcy5wYXJlbnQuZ2V0QXR0cmlidXRlKFwiZXhwYW5kSWNvblwiKSB8fCBcInBsdXMtc2lnblwiO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZXhwSWNvbiA9IFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIsIHsgY2xhc3NOYW1lOiBcImdseXBoaWNvbiBnbHlwaGljb24tXCIgKyBleHBhbmRJY29uLCBzdHlsZTogeyBcInBhZGRpbmctcmlnaHRcIjogXCIxMHB4XCIgfSwgb25DbGljazogdGhpcy50b2dnbGVFeHBhbmQgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIHF1ZXVlSXRlbXMgPSBudWxsO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5leHBhbmRlZCA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgcXVldWVJdGVtcyA9IFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJ1bFwiLCB7IGNsYXNzTmFtZTogXCJ0cmVlLWxlYWZcIiB9LCB0aGlzLmNoaWxkTm9kZXMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vPHNwYW4gY2xhc3NOYW1lPXtcInF1ZXVlLWNvdW50XCJ9ID57XCIoXCIgKyBxdWV1ZXMubGVuZ3RoICsgXCIpXCJ9PC9zcGFuPlxyXG4gICAgICAgICAgICByZXR1cm4gUmVhY3QuY3JlYXRlRWxlbWVudChcImxpXCIsIHsgY2xhc3NOYW1lOiBcInRyZWUtcm9vdC1pdGVtXCIgfSxcclxuICAgICAgICAgICAgICAgIGV4cEljb24sXHJcbiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwic3BhblwiLCB7IGNsYXNzTmFtZTogXCJnbHlwaGljb24gZ2x5cGhpY29uLVwiICsgaWNvbiB9KSxcclxuICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIsIHsgY2xhc3NOYW1lOiBcInF1ZXVlLWdyb3VwLWxhYmVsXCIgfSwgZ3JvdXBOYW1lKSxcclxuICAgICAgICAgICAgICAgIHF1ZXVlSXRlbXMpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICByZXR1cm4gVHJlZVBhcmVudE5vZGU7XHJcbn0oUmVhY3QuQ29tcG9uZW50KSk7XHJcbnZhciBUcmVlQ2hpbGROb2RlID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKFRyZWVDaGlsZE5vZGUsIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBUcmVlQ2hpbGROb2RlKHByb3BzKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgcHJvcHMpIHx8IHRoaXM7XHJcbiAgICAgICAgX3RoaXMuc2VsZWN0ZWQgPSBmYWxzZTtcclxuICAgICAgICBfdGhpcy5wYXJlbnQgPSBudWxsO1xyXG4gICAgICAgIF90aGlzLnF1ZXVlID0gbnVsbDtcclxuICAgICAgICBfdGhpcy5wYXJlbnQgPSBwcm9wcy5wYXJlbnQ7XHJcbiAgICAgICAgX3RoaXMucXVldWUgPSBwcm9wcy5xdWV1ZTtcclxuICAgICAgICBfdGhpcy5zZWxlY3QgPSBfdGhpcy5zZWxlY3QuYmluZChfdGhpcyk7XHJcbiAgICAgICAgX3RoaXMuZGVzZWxlY3QgPSBfdGhpcy5kZXNlbGVjdC5iaW5kKF90aGlzKTtcclxuICAgICAgICB2YXIgc2VsZWN0ZWRRdWV1ZUlkID0gX3RoaXMucGFyZW50LnBhcmVudC5nZXRTZWxlY3RlZEl0ZW0oKTtcclxuICAgICAgICBfdGhpcy5zZWxlY3RlZCA9IG1hbnl3aG8udXRpbHMuZ2V0T2JqZWN0RGF0YVByb3BlcnR5KF90aGlzLnF1ZXVlLnByb3BlcnRpZXMsIF90aGlzLnByb3BzLnBhcmVudC5wcm9wcy5wYXJlbnQuZ2V0QXR0cmlidXRlKFwiY2hpbGRLZXlBdHRyaWJ1dGVcIikpLmNvbnRlbnRWYWx1ZSA9PT0gc2VsZWN0ZWRRdWV1ZUlkO1xyXG4gICAgICAgIHJldHVybiBfdGhpcztcclxuICAgIH1cclxuICAgIFRyZWVDaGlsZE5vZGUucHJvdG90eXBlLnNlbGVjdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAvL3RlbGwgcGFyZW50IHRvIGRlc2VsZWN0IGFsbFxyXG4gICAgICAgIHRoaXMucGFyZW50LnBhcmVudC5zZWxlY3RJdGVtKG1hbnl3aG8udXRpbHMuZ2V0T2JqZWN0RGF0YVByb3BlcnR5KHRoaXMucXVldWUucHJvcGVydGllcywgdGhpcy5wYXJlbnQucGFyZW50LmdldEF0dHJpYnV0ZShcImNoaWxkS2V5QXR0cmlidXRlXCIpKS5jb250ZW50VmFsdWUpO1xyXG4gICAgICAgIC8vbm93IHNldCBtZSBzZWxlY3RlZFxyXG4gICAgICAgIHRoaXMuc2VsZWN0ZWQgPSB0cnVlO1xyXG4gICAgICAgIC8vY2xvbmUgZGF0YVxyXG4gICAgICAgIHZhciBvYmplY3REYXRhID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLnF1ZXVlKSk7XHJcbiAgICAgICAgb2JqZWN0RGF0YS5pc1NlbGVjdGVkID0gdHJ1ZTtcclxuICAgICAgICB2YXIgbmV3U3RhdGUgPSB7XHJcbiAgICAgICAgICAgIG9iamVjdERhdGE6IFtvYmplY3REYXRhXVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgLy9vYmplY3REYXRhPXRoaXMucHJvcHMuZGF0YTtcclxuICAgICAgICBtYW55d2hvLnN0YXRlLnNldENvbXBvbmVudCh0aGlzLnBhcmVudC5wYXJlbnQuY29tcG9uZW50SWQsIG5ld1N0YXRlLCB0aGlzLnBhcmVudC5wYXJlbnQuZmxvd0tleSwgdHJ1ZSk7XHJcbiAgICAgICAgLy90aGlzLmZvcmNlVXBkYXRlKCk7XHJcbiAgICAgICAgdmFyIG91dGNvbWUgPSBtYW55d2hvLm1vZGVsLmdldE91dGNvbWUodGhpcy5wYXJlbnQucGFyZW50LmdldEF0dHJpYnV0ZShcIm91dGNvbWVJZEZvclNlbGVjdFwiKSwgdGhpcy5wYXJlbnQucGFyZW50LmZsb3dLZXkpO1xyXG4gICAgICAgIG1hbnl3aG8uY29tcG9uZW50Lm9uT3V0Y29tZShvdXRjb21lLCBudWxsLCB0aGlzLnBhcmVudC5wYXJlbnQuZmxvd0tleSk7XHJcbiAgICB9O1xyXG4gICAgVHJlZUNoaWxkTm9kZS5wcm90b3R5cGUuZGVzZWxlY3QgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdGhpcy5zZWxlY3RlZCA9IGZhbHNlO1xyXG4gICAgfTtcclxuICAgIFRyZWVDaGlsZE5vZGUucHJvdG90eXBlLmNvbXBvbmVudERpZE1vdW50ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIC8vaXQncyBhIGNvbXBsZXggdHlwZSBvYmplY3QgLSBuZWVkIHRvIHNldCBpdCBmcm9tIHRoZSBtb2RlbCB0byB0aGUgc3RhdGUgdG8gaW5pdGlhbGl6ZSB0aGUgb3V0cHV0IG90aGVyd2lzZSBpdCB3aWxsIGJlIG51bGxcclxuICAgICAgICB2YXIgb2JqZWN0RGF0YSA9IG51bGw7XHJcbiAgICAgICAgdmFyIGZsb3dNb2RlbCA9IG1hbnl3aG8ubW9kZWwuZ2V0Q29tcG9uZW50KHRoaXMucGFyZW50LnBhcmVudC5jb21wb25lbnRJZCwgdGhpcy5wYXJlbnQucGFyZW50LmZsb3dLZXkpO1xyXG4gICAgICAgIHZhciBmbG93U3RhdGUgPSBtYW55d2hvLnN0YXRlLmdldENvbXBvbmVudCh0aGlzLnBhcmVudC5wYXJlbnQuY29tcG9uZW50SWQsIHRoaXMucGFyZW50LnBhcmVudC5mbG93S2V5KSB8fCB7fTtcclxuICAgICAgICBpZiAoZmxvd1N0YXRlICYmIGZsb3dTdGF0ZS5vYmplY3REYXRhICYmIGZsb3dTdGF0ZS5vYmplY3REYXRhWzBdICYmIGZsb3dTdGF0ZS5vYmplY3REYXRhWzBdLnByb3BlcnRpZXMpIHtcclxuICAgICAgICAgICAgb2JqZWN0RGF0YSA9IGZsb3dTdGF0ZS5vYmplY3REYXRhWzBdO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChmbG93TW9kZWwgJiYgZmxvd01vZGVsLm9iamVjdERhdGEgJiYgZmxvd01vZGVsLm9iamVjdERhdGFbMF0pIHtcclxuICAgICAgICAgICAgb2JqZWN0RGF0YSA9IGZsb3dNb2RlbC5vYmplY3REYXRhWzBdO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvL21hbnl3aG8uc3RhdGUuc2V0Q29tcG9uZW50KHRoaXMucHJvcHMucGFyZW50LnByb3BzLnBhcmVudC5wcm9wcy5pZCwge29iamVjdERhdGE6IFtdfSwgdGhpcy5wcm9wcy5wYXJlbnQucHJvcHMucGFyZW50LnByb3BzLmZsb3dLZXksIHRydWUpO1xyXG4gICAgICAgIC8vaWYgdGhlcmUncyBvbmUgc2VsZWN0ZWQgdGhlbiBmbGFnIGl0IHNlbGVjdGVkXHJcbiAgICAgICAgaWYgKG9iamVjdERhdGEpIHtcclxuICAgICAgICAgICAgLy9jb25zb2xlLmxvZygnc2VsZWN0ZWQgaXRlbScpO1xyXG4gICAgICAgICAgICAvL3NvIHRoZXJlIGlzIGEgY3VycmVudCBxdWV1ZSBzZWxlY3RlZCBidXQgaXMgaXQgdGhlIGN1cnJlbnQgb25lP1xyXG4gICAgICAgICAgICB2YXIgcXVldWVJZCA9IG1hbnl3aG8udXRpbHMuZ2V0T2JqZWN0RGF0YVByb3BlcnR5KHRoaXMucXVldWUucHJvcGVydGllcywgdGhpcy5wYXJlbnQucGFyZW50LmdldEF0dHJpYnV0ZShcImNoaWxkS2V5QXR0cmlidXRlXCIpKS5jb250ZW50VmFsdWU7XHJcbiAgICAgICAgICAgIHZhciBzZWxlY3RlZFF1ZXVlSWQgPSBtYW55d2hvLnV0aWxzLmdldE9iamVjdERhdGFQcm9wZXJ0eShvYmplY3REYXRhLnByb3BlcnRpZXMsIHRoaXMucGFyZW50LnBhcmVudC5nZXRBdHRyaWJ1dGUoXCJjaGlsZEtleUF0dHJpYnV0ZVwiKSkuY29udGVudFZhbHVlO1xyXG4gICAgICAgICAgICAvL2NvbnNvbGUubG9nKCdxaWQ9JyArIHF1ZXVlSWQpO1xyXG4gICAgICAgICAgICAvLy9jb25zb2xlLmxvZygnc2VsZWN0ZWQgcWlkPScgKyBzZWxlY3RlZFF1ZXVlSWQpO1xyXG4gICAgICAgICAgICBpZiAocXVldWVJZCA9PT0gc2VsZWN0ZWRRdWV1ZUlkKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBUcmVlQ2hpbGROb2RlLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGZsb3dTdGF0ZSA9IG1hbnl3aG8uc3RhdGUuZ2V0Q29tcG9uZW50KHRoaXMucGFyZW50LnBhcmVudC5jb21wb25lbnRJZCwgdGhpcy5wYXJlbnQucGFyZW50LmZsb3dLZXkpO1xyXG4gICAgICAgIHZhciBmbG93TW9kZWwgPSBtYW55d2hvLm1vZGVsLmdldENvbXBvbmVudCh0aGlzLnBhcmVudC5wYXJlbnQuY29tcG9uZW50SWQsIHRoaXMucGFyZW50LnBhcmVudC5mbG93S2V5KTtcclxuICAgICAgICBpZiAoZmxvd1N0YXRlLmxvYWRpbmcpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB2YXIgcXVldWVJZCA9IG1hbnl3aG8udXRpbHMuZ2V0T2JqZWN0RGF0YVByb3BlcnR5KHRoaXMucXVldWUucHJvcGVydGllcywgdGhpcy5wYXJlbnQucGFyZW50LmdldEF0dHJpYnV0ZShcImNoaWxkS2V5QXR0cmlidXRlXCIpKS5jb250ZW50VmFsdWU7XHJcbiAgICAgICAgICAgIHZhciBxdWV1ZU5hbWUgPSBtYW55d2hvLnV0aWxzLmdldE9iamVjdERhdGFQcm9wZXJ0eSh0aGlzLnF1ZXVlLnByb3BlcnRpZXMsIHRoaXMucGFyZW50LnBhcmVudC5nZXRBdHRyaWJ1dGUoXCJjaGlsZExhYmVsQXR0cmlidXRlXCIpKS5jb250ZW50VmFsdWU7XHJcbiAgICAgICAgICAgIHZhciBzdWJMYWJlbCA9IG1hbnl3aG8udXRpbHMuZ2V0T2JqZWN0RGF0YVByb3BlcnR5KHRoaXMucXVldWUucHJvcGVydGllcywgdGhpcy5wYXJlbnQucGFyZW50LmdldEF0dHJpYnV0ZShcImNoaWxkU3ViTGFiZWxBdHRyaWJ1dGVcIikpLmNvbnRlbnRWYWx1ZTtcclxuICAgICAgICAgICAgdmFyIGljb24gPSBtYW55d2hvLnV0aWxzLmdldE9iamVjdERhdGFQcm9wZXJ0eSh0aGlzLnF1ZXVlLnByb3BlcnRpZXMsIHRoaXMucGFyZW50LnBhcmVudC5nZXRBdHRyaWJ1dGUoXCJjaGlsZEljb25BdHRyaWJ1dGVcIikpLmNvbnRlbnRWYWx1ZTtcclxuICAgICAgICAgICAgaWYgKCFpY29uIHx8IGljb24ubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICBpY29uID0gdGhpcy5wYXJlbnQucGFyZW50LmdldEF0dHJpYnV0ZShcImNoaWxkRGVmYXVsdEljb25cIikgfHwgXCJ0YXNrc1wiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBjbGFzc05hbWUgPSB0aGlzLnNlbGVjdGVkID8gJ3RyZWUtbGVhZiB0cmVlLWxlYWYtc2VsZWN0ZWQnIDogJ3RyZWUtbGVhZic7XHJcbiAgICAgICAgICAgIC8vcmV0dXJuIFJlYWN0LmNyZWF0ZUVsZW1lbnQoICdsaScgLCB7cmVmOiBxdWV1ZUlkLCBcImRhdGEtcXVldWVJZFwiOiBxdWV1ZUlkLCBjbGFzc05hbWU6IGNsYXNzTmFtZSwgb25DbGljazogdGhpcy5zZWxlY3QgfSAsIGl0ZW1zICk7XHJcbiAgICAgICAgICAgIHJldHVybiBSZWFjdC5jcmVhdGVFbGVtZW50KFwibGlcIiwgeyBjbGFzc05hbWU6IGNsYXNzTmFtZSwgb25DbGljazogdGhpcy5zZWxlY3QgfSxcclxuICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIsIHsgY2xhc3NOYW1lOiAnZ2x5cGhpY29uIGdseXBoaWNvbi0nICsgaWNvbiB9KSxcclxuICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIsIHsgY2xhc3NOYW1lOiAncXVldWUtbGFiZWwnIH0sIHF1ZXVlTmFtZSksXHJcbiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwic3BhblwiLCB7IGNsYXNzTmFtZTogJ3F1ZXVlLWNvdW50JyB9LCBcIihcIiArIHN1YkxhYmVsICsgXCIpXCIpKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIFRyZWVDaGlsZE5vZGU7XHJcbn0oUmVhY3QuQ29tcG9uZW50KSk7XHJcbm1hbnl3aG8uY29tcG9uZW50LnJlZ2lzdGVyKCdUcmVlVmlldycsIFRyZWVWaWV3KTtcclxuZXhwb3J0cy5kZWZhdWx0ID0gVHJlZVZpZXc7XHJcblxuXG4vKioqLyB9KSxcbi8qIDIgKi9cbi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHtcblxubW9kdWxlLmV4cG9ydHMgPSBSZWFjdDtcblxuLyoqKi8gfSksXG4vKiAzICovXG4vKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzKSB7XG5cbi8vIHJlbW92ZWQgYnkgZXh0cmFjdC10ZXh0LXdlYnBhY2stcGx1Z2luXG5cbi8qKiovIH0pXG4vKioqKioqLyBdKTtcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gVHJlZVZpZXcuanMiLCIgXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuXG4gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXG4gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSkge1xuIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuIFx0XHR9XG4gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbiBcdFx0XHRpOiBtb2R1bGVJZCxcbiBcdFx0XHRsOiBmYWxzZSxcbiBcdFx0XHRleHBvcnRzOiB7fVxuIFx0XHR9O1xuXG4gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4gXHRcdG1vZHVsZS5sID0gdHJ1ZTtcblxuIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4gXHR9XG5cblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuXG4gXHQvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9uIGZvciBoYXJtb255IGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIG5hbWUsIGdldHRlcikge1xuIFx0XHRpZighX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIG5hbWUpKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG5hbWUsIHtcbiBcdFx0XHRcdGNvbmZpZ3VyYWJsZTogZmFsc2UsXG4gXHRcdFx0XHRlbnVtZXJhYmxlOiB0cnVlLFxuIFx0XHRcdFx0Z2V0OiBnZXR0ZXJcbiBcdFx0XHR9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAwKTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyB3ZWJwYWNrL2Jvb3RzdHJhcCA2NThhYjdiNGFhMTc0Y2Q4ZDE3NSIsImV4cG9ydCAqIGZyb20gJy4vVHJlZVZpZXcnO1xuXG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gLi9zcmMvaW5kZXgudHN4IiwiZGVjbGFyZSB2YXIgbWFueXdobzogYW55O1xyXG5cclxuaW1wb3J0ICogYXMgUmVhY3QgZnJvbSAncmVhY3QnO1xyXG5pbXBvcnQgJy4vVHJlZVZpZXcuY3NzJztcclxuXHJcbmNsYXNzIFRyZWVWaWV3IGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50PGFueSwgYW55PiBcclxueyAgIFxyXG4gICAgY29tcG9uZW50SWQ6IHN0cmluZyA9IFwiXCI7XHJcbiAgICBmbG93S2V5OiBzdHJpbmcgPVwiXCI7ICAgIFxyXG4gICAgYXR0cmlidXRlcyA9IG5ldyBNYXA8c3RyaW5nLGFueT4oKTtcclxuICAgIGNoaWxkTm9kZXM6IEFycmF5PFRyZWVQYXJlbnROb2RlPiA9IFtdO1xyXG4gICAgc2VsZWN0ZWRJdGVtOiBzdHJpbmcgPSBudWxsO1xyXG5cclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwcm9wcyA6IGFueSlcclxuXHR7XHJcbiAgICAgICAgc3VwZXIocHJvcHMpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHRoaXMuY29tcG9uZW50SWQgPSBwcm9wcy5pZDtcclxuICAgICAgICB0aGlzLmZsb3dLZXkgPSBwcm9wcy5mbG93S2V5O1xyXG5cclxuICAgICAgICAvL3B1c2ggYXR0cmlidXRlcyBpbnRvIGtleWVkIG1hcCBcclxuXHRcdHZhciBmbG93TW9kZWwgPSBtYW55d2hvLm1vZGVsLmdldENvbXBvbmVudCh0aGlzLnByb3BzLmlkLCAgIHRoaXMucHJvcHMuZmxvd0tleSk7XHJcblx0XHRpZihmbG93TW9kZWwuYXR0cmlidXRlcylcclxuXHRcdHtcclxuXHRcdFx0Zm9yKHZhciBrZXkgaW4gZmxvd01vZGVsLmF0dHJpYnV0ZXMpXHJcblx0XHRcdHtcclxuXHRcdFx0XHR0aGlzLmF0dHJpYnV0ZXMuc2V0KGtleSAsZmxvd01vZGVsLmF0dHJpYnV0ZXNba2V5XSk7XHJcblx0XHRcdH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY29tcG9uZW50RGlkTW91bnQoKSBcclxuICAgIHtcclxuICAgICAgICBcclxuXHJcbiAgICAgICAgdGhpcy5mb3JjZVVwZGF0ZSgpO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvL3RoaXMgd2lsbCBiZSB0cmlnZ2VyZWQgaWYgYW55IGxlYWYgaXMgc2VsZWN0ZWRcclxuXHRzZWxlY3RJdGVtKGlkIDogc3RyaW5nKVxyXG5cdHtcclxuXHRcdHRoaXMuc2VsZWN0ZWRJdGVtID0gaWQ7XHJcblx0XHQgXHJcblx0XHQvL2xvb3AgdGhyb3VnaCBjaGlsZHJlbiB0ZWxsaW5nIGVhY2ggdG8gZGVzZWxlY3QgdGhlaXIgY2hpbGRyZW5cclxuXHRcdGZvcih2YXIga2V5IGluIHRoaXMucmVmcylcclxuXHRcdHtcclxuICAgICAgICAgICAgKHRoaXMucmVmc1trZXldIGFzIFRyZWVQYXJlbnROb2RlKS5kZXNlbGVjdEFsbENoaWxkcmVuKCk7XHJcblx0XHR9XHJcblx0fVxyXG5cdFxyXG5cdGdldFNlbGVjdGVkSXRlbSgpXHJcblx0e1xyXG5cdFx0cmV0dXJuIHRoaXMuc2VsZWN0ZWRJdGVtO1xyXG5cdH1cclxuXHRcclxuXHRnZXRBdHRyaWJ1dGUoYXR0cmlidXRlTmFtZSA6IHN0cmluZylcclxuXHR7XHJcblx0XHRpZih0aGlzLmF0dHJpYnV0ZXMuaGFzKGF0dHJpYnV0ZU5hbWUpKVxyXG5cdFx0e1xyXG5cdFx0XHRyZXR1cm4gdGhpcy5hdHRyaWJ1dGVzLmdldChhdHRyaWJ1dGVOYW1lKTtcclxuXHRcdH1cclxuXHRcdGVsc2VcclxuXHRcdHtcclxuXHRcdFx0cmV0dXJuIG51bGw7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRcclxuXHRyZW5kZXIoKVxyXG5cdHtcclxuXHQgICBcclxuXHRcdGNvbnN0IGZsb3dNb2RlbCA9IG1hbnl3aG8ubW9kZWwuZ2V0Q29tcG9uZW50KHRoaXMucHJvcHMuaWQsICAgdGhpcy5wcm9wcy5mbG93S2V5KTtcclxuICAgICAgICBjb25zdCBmbG93U3RhdGUgPSBtYW55d2hvLnN0YXRlLmdldENvbXBvbmVudCh0aGlzLnByb3BzLmlkLCAgIHRoaXMucHJvcHMuZmxvd0tleSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgdmFyIHN0eWxlcyA9IG5ldyBNYXA8c3RyaW5nLHN0cmluZz4oKTtcclxuICAgICAgICBpZihmbG93TW9kZWwud2lkdGggJiYgZmxvd01vZGVsLndpZHRoID4gMCl7XHRzdHlsZXMuc2V0KFwid2lkdGhcIiwgZmxvd01vZGVsLndpZHRoICsgXCJweFwiKTt9XHJcbiAgICAgICAgaWYoZmxvd01vZGVsLmhlaWdodCAmJiBmbG93TW9kZWwuaGVpZ2h0ID4gMCl7c3R5bGVzLnNldChcImhlaWdodFwiLCBmbG93TW9kZWwuaGVpZ2h0ICsgXCJweFwiKTt9XHJcblxyXG4gICAgICAgIC8vY3JlYXRlIGFuIGFycmF5IG9mIFRyZWVQYXJlbnROb2RlIGNsYXNzZXMgZm9yIHRoZSBkYXRhXHJcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gICAgICAgIHRoaXMuY2hpbGROb2RlcyA9IGZsb3dNb2RlbC5vYmplY3REYXRhLm1hcChmdW5jdGlvbihncm91cCA6IGFueSwgaW5kZXggOiBhbnkpe1xyXG4gICAgICAgICAgICB2YXIgZ3JvdXBJZCA9IG1hbnl3aG8udXRpbHMuZ2V0T2JqZWN0RGF0YVByb3BlcnR5KGdyb3VwLnByb3BlcnRpZXMsIHNlbGYuZ2V0QXR0cmlidXRlKFwicGFyZW50S2V5QXR0cmlidXRlXCIpKS5jb250ZW50VmFsdWU7XHJcbiAgICAgICAgICAgIHJldHVybihcclxuICAgICAgICAgICAgICAgIDxUcmVlUGFyZW50Tm9kZSByZWY9e1wiR19cIiArIGdyb3VwSWR9IHBhcmVudD17c2VsZn0gZ3JvdXA9e2dyb3VwfSAvPlxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXR1cm4gPGRpdiBjbGFzc05hbWU9IFwidHJlZS12aWV3XCIgc3R5bGU9IHtzdHlsZXN9PlxyXG4gICAgICAgICAgICAgICAgPHVsIGNsYXNzTmFtZT1cInRyZWUtcm9vdFwiPiBcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2hpbGROb2Rlc1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIDwvdWw+XHJcbiAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgfVxyXG59XHJcblxyXG5jbGFzcyBUcmVlUGFyZW50Tm9kZSBleHRlbmRzIFJlYWN0LkNvbXBvbmVudDxhbnksIGFueT5cclxue1xyXG4gICAgY2hpbGROb2RlczogQXJyYXk8VHJlZUNoaWxkTm9kZT4gPSBbXTtcclxuICAgIGV4cGFuZGVkIDogYm9vbGVhbiA9IGZhbHNlO1xyXG4gICAgcGFyZW50IDogVHJlZVZpZXcgPSBudWxsO1xyXG4gICAgcXVldWVHcm91cCA6IGFueSA9IG51bGw7XHJcbiAgICBcclxuICAgIGNvbnN0cnVjdG9yKHByb3BzIDogYW55KVxyXG4gICAge1xyXG4gICAgICAgIHN1cGVyKHByb3BzKTtcclxuICAgICAgICB0aGlzLnBhcmVudCA9IHByb3BzLnBhcmVudDtcclxuICAgICAgICB0aGlzLnF1ZXVlR3JvdXAgPSBwcm9wcy5ncm91cDtcclxuXHJcbiAgICAgICAgdGhpcy5kZXNlbGVjdEFsbENoaWxkcmVuID0gdGhpcy5kZXNlbGVjdEFsbENoaWxkcmVuLmJpbmQodGhpcyk7XHJcbiAgICAgICAgdGhpcy50b2dnbGVFeHBhbmQgPSB0aGlzLnRvZ2dsZUV4cGFuZC5iaW5kKHRoaXMpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vc2V0IGRlZmF1bHQgZXhwYW5kZWRcclxuICAgICAgICB0aGlzLmV4cGFuZGVkID0gdGhpcy5wYXJlbnQuZ2V0QXR0cmlidXRlKFwic2hvd0V4cGFuZGVkXCIpID09PSBcInRydWVcIj8gdHJ1ZSA6IGZhbHNlO1xyXG4gICAgfVxyXG4gICAgXHJcblx0Y29tcG9uZW50RGlkTW91bnQoKSBcclxuXHR7XHJcblx0ICAgLy8gdGhpcy5wcm9wcy5vblJlZih0aGlzKVxyXG5cdH1cclxuXHRcclxuXHRjb21wb25lbnRXaWxsVW5tb3VudCgpIFxyXG5cdHtcclxuXHQgICAvLyB0aGlzLnByb3BzLm9uUmVmKHVuZGVmaW5lZClcclxuXHR9XHJcblx0XHJcblx0dG9nZ2xlRXhwYW5kKClcclxuXHR7XHJcbiAgICAgICAgdGhpcy5leHBhbmRlZCA9ICF0aGlzLmV4cGFuZGVkO1xyXG4gICAgICAgIHRoaXMuZm9yY2VVcGRhdGUoKTtcclxuXHR9XHJcblx0XHJcblx0ZGVzZWxlY3RBbGxDaGlsZHJlbigpXHJcblx0e1xyXG4gICAgICAgIGZvcih2YXIga2V5IGluIHRoaXMucmVmcylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgICh0aGlzLnJlZnNba2V5XSBhcyBUcmVlQ2hpbGROb2RlKS5kZXNlbGVjdCgpO1xyXG4gICAgICAgIH1cclxuXHR9XHJcblxyXG5cdHJlbmRlcigpXHJcblx0e1xyXG4gICAgICAgIFxyXG5cdFx0Y29uc3QgZmxvd1N0YXRlID0gbWFueXdoby5zdGF0ZS5nZXRDb21wb25lbnQodGhpcy5wYXJlbnQuY29tcG9uZW50SWQsICAgdGhpcy5wYXJlbnQuZmxvd0tleSk7XHJcblx0XHRjb25zdCBmbG93TW9kZWwgPSBtYW55d2hvLm1vZGVsLmdldENvbXBvbmVudCh0aGlzLnBhcmVudC5jb21wb25lbnRJZCwgICB0aGlzLnBhcmVudC5mbG93S2V5KTtcclxuXHRcdFxyXG5cdFx0dmFyIGl0ZW1zID0gW107XHJcblx0XHR2YXIgd29ya1F1ZXVlcyA9IFtdO1xyXG5cdFx0dGhpcy5jaGlsZE5vZGVzID0gW107XHJcblx0XHRcclxuXHRcdGlmKGZsb3dTdGF0ZS5sb2FkaW5nKVxyXG5cdFx0e1xyXG5cdFx0XHRyZXR1cm4gbnVsbDtcclxuXHRcdH1cclxuXHRcdGVsc2VcclxuXHRcdHtcclxuXHRcdFx0Ly9nZXQgZ3JvdXAgbmFtZVxyXG5cdFx0XHR2YXIgZ3JvdXBOYW1lID0gbWFueXdoby51dGlscy5nZXRPYmplY3REYXRhUHJvcGVydHkodGhpcy5xdWV1ZUdyb3VwLnByb3BlcnRpZXMsIHRoaXMucGFyZW50LmdldEF0dHJpYnV0ZShcInBhcmVudExhYmVsQXR0cmlidXRlXCIpKS5jb250ZW50VmFsdWU7XHJcblx0XHRcdFxyXG5cdFx0XHQvL2dldCBxdWV1ZXNcclxuXHRcdFx0dmFyIHF1ZXVlcyA9ICBtYW55d2hvLnV0aWxzLmdldE9iamVjdERhdGFQcm9wZXJ0eSh0aGlzLnF1ZXVlR3JvdXAucHJvcGVydGllcywgdGhpcy5wYXJlbnQuZ2V0QXR0cmlidXRlKFwicGFyZW50Q2hpbGRBcnJheUF0dHJpYnV0ZVwiKSkub2JqZWN0RGF0YTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuXHJcbiAgIFxyXG5cdFx0XHRpZihxdWV1ZXMpXHJcblx0XHRcdHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2hpbGROb2RlcyA9IHF1ZXVlcy5tYXAoZnVuY3Rpb24ocXVldWUgOiBhbnksIGluZGV4IDogYW55KXtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcXVldWVJZCA9IG1hbnl3aG8udXRpbHMuZ2V0T2JqZWN0RGF0YVByb3BlcnR5KHF1ZXVlLnByb3BlcnRpZXMsIHNlbGYucGFyZW50LmdldEF0dHJpYnV0ZShcInBhcmVudEtleUF0dHJpYnV0ZVwiKSkuY29udGVudFZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybihcclxuICAgICAgICAgICAgICAgICAgICAgICAgPFRyZWVDaGlsZE5vZGUgcmVmPXtcIlFfXCIgKyBxdWV1ZUlkfSBwYXJlbnQ9e3NlbGZ9IHF1ZXVlPXtxdWV1ZX0gLz5cclxuICAgICAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG5cdFx0XHRcdFxyXG5cdFx0XHR9XHJcblx0XHRcdFxyXG5cdFx0XHR2YXIgaWNvbiA9IG1hbnl3aG8udXRpbHMuZ2V0T2JqZWN0RGF0YVByb3BlcnR5KHRoaXMucXVldWVHcm91cC5wcm9wZXJ0aWVzLCB0aGlzLnBhcmVudC5nZXRBdHRyaWJ1dGUoXCJwYXJlbnRJY29uQXR0cmlidXRlXCIpKS5jb250ZW50VmFsdWU7XHJcblx0XHRcdFxyXG5cdFx0XHRpZighaWNvbiB8fCBpY29uLmxlbmd0aD09PTApXHJcblx0XHRcdHtcclxuXHRcdFx0XHRpY29uID0gdGhpcy5wYXJlbnQuZ2V0QXR0cmlidXRlKFwicGFyZW50RGVmYXVsdEljb25cIikgfHwgXCJlbnZlbG9wZVwiO1xyXG5cdFx0XHR9XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvL25lZWQgdG8ga25vdyBob3cgbWFueSBjaGlsZCBxdWV1ZXMgYXJlIGluIGdyb3VwXHJcblxyXG4gICAgICAgICAgICB2YXIgZXhwSWNvbiA6IGFueSA9IG51bGw7XHJcblx0XHRcdGlmKHRoaXMucGFyZW50LmdldEF0dHJpYnV0ZShcImlzQ29sbGFwc2libGVcIikgPT09IFwidHJ1ZVwiICYmIHF1ZXVlcy5sZW5ndGggPiAwKVxyXG5cdFx0XHR7XHJcblx0XHRcdFx0dmFyIGV4cGFuZEljb24gPSAgXCJcIjtcclxuXHRcdFx0XHRpZiggdGhpcy5leHBhbmRlZCA9PT0gdHJ1ZSlcclxuXHRcdFx0XHR7XHJcblx0XHRcdFx0XHQgZXhwYW5kSWNvbiA9IHRoaXMucGFyZW50LmdldEF0dHJpYnV0ZShcImNvbnRyYWN0SWNvblwiKSB8fCBcIm1pbnVzLXNpZ25cIlxyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlXHJcblx0XHRcdFx0e1xyXG5cdFx0XHRcdFx0ZXhwYW5kSWNvbiA9IHRoaXMucGFyZW50LmdldEF0dHJpYnV0ZShcImV4cGFuZEljb25cIikgfHwgXCJwbHVzLXNpZ25cIjtcclxuXHRcdFx0XHR9XHJcbiAgICAgICAgICAgICAgIGV4cEljb24gPSA8c3BhbiBjbGFzc05hbWU9e1wiZ2x5cGhpY29uIGdseXBoaWNvbi1cIiArIGV4cGFuZEljb259IHN0eWxlPXt7XCJwYWRkaW5nLXJpZ2h0XCI6XCIxMHB4XCJ9fSBvbkNsaWNrPSB7dGhpcy50b2dnbGVFeHBhbmR9ID48L3NwYW4+O1xyXG4gICAgICAgICAgICB9XHJcblx0XHRcdHZhciBxdWV1ZUl0ZW1zIDogYW55ID0gbnVsbDtcclxuXHRcdFx0aWYoIHRoaXMuZXhwYW5kZWQgPT09IHRydWUpXHJcblx0XHRcdHtcclxuXHRcdFx0XHRxdWV1ZUl0ZW1zID0gPHVsIGNsYXNzTmFtZT1cInRyZWUtbGVhZlwiPlxyXG4gICAgICAgICAgICAgICAge3RoaXMuY2hpbGROb2Rlc308L3VsPjtcclxuXHRcdFx0fVxyXG5cdFx0XHRcclxuXHRcdFx0Ly88c3BhbiBjbGFzc05hbWU9e1wicXVldWUtY291bnRcIn0gPntcIihcIiArIHF1ZXVlcy5sZW5ndGggKyBcIilcIn08L3NwYW4+XHJcbiAgICAgICAgICAgIHJldHVybiA8bGkgY2xhc3NOYW1lPVwidHJlZS1yb290LWl0ZW1cIj5cclxuICAgICAgICAgICAgICAgIHtleHBJY29ufVxyXG4gICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPXtcImdseXBoaWNvbiBnbHlwaGljb24tXCIgKyBpY29ufSA+PC9zcGFuPlxyXG4gICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPXtcInF1ZXVlLWdyb3VwLWxhYmVsXCJ9ID57Z3JvdXBOYW1lfTwvc3Bhbj5cclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAge3F1ZXVlSXRlbXN9XHJcblxyXG4gICAgICAgICAgICA8L2xpPjtcclxuICAgICAgICB9XHJcbiAgICAgICAgIFxyXG4gICAgICAgIFxyXG4gICAgfVxyXG59XHJcblxyXG5jbGFzcyBUcmVlQ2hpbGROb2RlIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50PGFueSwgYW55PlxyXG57XHJcbiAgICBzZWxlY3RlZCA6IGJvb2xlYW4gPSBmYWxzZTtcclxuICAgIHBhcmVudCA6IFRyZWVQYXJlbnROb2RlID0gbnVsbDtcclxuICAgIHF1ZXVlIDogYW55ID0gbnVsbDtcclxuXHJcblx0Y29uc3RydWN0b3IocHJvcHMgOiBhbnkpXHJcblx0e1xyXG5cdFx0c3VwZXIocHJvcHMpO1xyXG4gICAgICAgIHRoaXMucGFyZW50ID0gcHJvcHMucGFyZW50O1xyXG4gICAgICAgIHRoaXMucXVldWUgPSBwcm9wcy5xdWV1ZTtcclxuICAgICAgICBcclxuICAgICAgICB0aGlzLnNlbGVjdCA9IHRoaXMuc2VsZWN0LmJpbmQodGhpcyk7XHJcbiAgICAgICAgdGhpcy5kZXNlbGVjdCA9IHRoaXMuZGVzZWxlY3QuYmluZCh0aGlzKTtcclxuXHRcdFxyXG5cdFx0dmFyIHNlbGVjdGVkUXVldWVJZCA9IHRoaXMucGFyZW50LnBhcmVudC5nZXRTZWxlY3RlZEl0ZW0oKTtcclxuXHRcdHRoaXMuc2VsZWN0ZWQgPSBtYW55d2hvLnV0aWxzLmdldE9iamVjdERhdGFQcm9wZXJ0eSh0aGlzLnF1ZXVlLnByb3BlcnRpZXMsIHRoaXMucHJvcHMucGFyZW50LnByb3BzLnBhcmVudC5nZXRBdHRyaWJ1dGUoXCJjaGlsZEtleUF0dHJpYnV0ZVwiKSkuY29udGVudFZhbHVlID09PSBzZWxlY3RlZFF1ZXVlSWQgIFx0XHQgXHJcblx0fVxyXG5cdFxyXG5cdHNlbGVjdCgpIFxyXG5cdHtcclxuXHRcdC8vdGVsbCBwYXJlbnQgdG8gZGVzZWxlY3QgYWxsXHJcblx0XHR0aGlzLnBhcmVudC5wYXJlbnQuc2VsZWN0SXRlbSggbWFueXdoby51dGlscy5nZXRPYmplY3REYXRhUHJvcGVydHkodGhpcy5xdWV1ZS5wcm9wZXJ0aWVzLCB0aGlzLnBhcmVudC5wYXJlbnQuZ2V0QXR0cmlidXRlKFwiY2hpbGRLZXlBdHRyaWJ1dGVcIikpLmNvbnRlbnRWYWx1ZSApO1xyXG5cdFx0Ly9ub3cgc2V0IG1lIHNlbGVjdGVkXHJcblx0XHR0aGlzLnNlbGVjdGVkID0gdHJ1ZTtcclxuXHRcdFxyXG5cdFx0XHJcblx0XHQvL2Nsb25lIGRhdGFcclxuXHRcdHZhciBvYmplY3REYXRhID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLnF1ZXVlKSk7XHJcblx0XHRvYmplY3REYXRhLmlzU2VsZWN0ZWQgPSB0cnVlO1xyXG5cdFx0dmFyIG5ld1N0YXRlID0ge1xyXG5cdFx0XHRvYmplY3REYXRhOiBbb2JqZWN0RGF0YV1cclxuXHRcdH07XHJcblx0XHRcclxuXHRcdFxyXG5cdFx0Ly9vYmplY3REYXRhPXRoaXMucHJvcHMuZGF0YTtcclxuXHRcdG1hbnl3aG8uc3RhdGUuc2V0Q29tcG9uZW50KHRoaXMucGFyZW50LnBhcmVudC5jb21wb25lbnRJZCwgbmV3U3RhdGUsIHRoaXMucGFyZW50LnBhcmVudC5mbG93S2V5LCB0cnVlKTtcclxuXHRcdFxyXG5cdFx0Ly90aGlzLmZvcmNlVXBkYXRlKCk7XHJcblx0XHR2YXIgb3V0Y29tZSA9IG1hbnl3aG8ubW9kZWwuZ2V0T3V0Y29tZSh0aGlzLnBhcmVudC5wYXJlbnQuZ2V0QXR0cmlidXRlKFwib3V0Y29tZUlkRm9yU2VsZWN0XCIpLCB0aGlzLnBhcmVudC5wYXJlbnQuZmxvd0tleSk7XHJcblx0XHRtYW55d2hvLmNvbXBvbmVudC5vbk91dGNvbWUob3V0Y29tZSwgbnVsbCAsIHRoaXMucGFyZW50LnBhcmVudC5mbG93S2V5KTtcclxuXHRcclxuXHR9XHJcblx0XHJcblx0ZGVzZWxlY3QoKSBcclxuXHR7XHJcblx0ICB0aGlzLnNlbGVjdGVkID0gZmFsc2U7XHJcblx0fVxyXG5cclxuXHRjb21wb25lbnREaWRNb3VudCgpXHJcblx0e1xyXG4gICAgICAgIFxyXG5cdFx0IC8vaXQncyBhIGNvbXBsZXggdHlwZSBvYmplY3QgLSBuZWVkIHRvIHNldCBpdCBmcm9tIHRoZSBtb2RlbCB0byB0aGUgc3RhdGUgdG8gaW5pdGlhbGl6ZSB0aGUgb3V0cHV0IG90aGVyd2lzZSBpdCB3aWxsIGJlIG51bGxcclxuXHRcdGxldCBvYmplY3REYXRhID0gbnVsbDtcclxuXHRcdFxyXG5cdFx0Y29uc3QgZmxvd01vZGVsID0gbWFueXdoby5tb2RlbC5nZXRDb21wb25lbnQodGhpcy5wYXJlbnQucGFyZW50LmNvbXBvbmVudElkLCAgIHRoaXMucGFyZW50LnBhcmVudC5mbG93S2V5KTtcclxuXHRcdGNvbnN0IGZsb3dTdGF0ZSA9IG1hbnl3aG8uc3RhdGUuZ2V0Q29tcG9uZW50KHRoaXMucGFyZW50LnBhcmVudC5jb21wb25lbnRJZCwgICB0aGlzLnBhcmVudC5wYXJlbnQuZmxvd0tleSkgfHwge307XHJcblxyXG5cdFx0aWYgKGZsb3dTdGF0ZSAmJiBmbG93U3RhdGUub2JqZWN0RGF0YSAmJiBmbG93U3RhdGUub2JqZWN0RGF0YVswXSAmJiBmbG93U3RhdGUub2JqZWN0RGF0YVswXS5wcm9wZXJ0aWVzKVxyXG5cdFx0e1xyXG5cdFx0XHRvYmplY3REYXRhID0gZmxvd1N0YXRlLm9iamVjdERhdGFbMF07XHJcblx0XHR9XHJcblx0XHRlbHNlIGlmIChmbG93TW9kZWwgJiYgZmxvd01vZGVsLm9iamVjdERhdGEgJiYgZmxvd01vZGVsLm9iamVjdERhdGFbMF0pXHJcblx0XHR7XHJcblx0XHRcdG9iamVjdERhdGEgPSBmbG93TW9kZWwub2JqZWN0RGF0YVswXTtcclxuXHRcdH1cclxuXHRcdFxyXG5cdFx0Ly9tYW55d2hvLnN0YXRlLnNldENvbXBvbmVudCh0aGlzLnByb3BzLnBhcmVudC5wcm9wcy5wYXJlbnQucHJvcHMuaWQsIHtvYmplY3REYXRhOiBbXX0sIHRoaXMucHJvcHMucGFyZW50LnByb3BzLnBhcmVudC5wcm9wcy5mbG93S2V5LCB0cnVlKTtcclxuXHRcdFxyXG5cdFx0Ly9pZiB0aGVyZSdzIG9uZSBzZWxlY3RlZCB0aGVuIGZsYWcgaXQgc2VsZWN0ZWRcclxuXHRcdFxyXG5cdFx0aWYob2JqZWN0RGF0YSlcclxuXHRcdHtcclxuXHRcdFx0Ly9jb25zb2xlLmxvZygnc2VsZWN0ZWQgaXRlbScpO1xyXG5cdFx0XHQvL3NvIHRoZXJlIGlzIGEgY3VycmVudCBxdWV1ZSBzZWxlY3RlZCBidXQgaXMgaXQgdGhlIGN1cnJlbnQgb25lP1xyXG5cdFx0XHR2YXIgcXVldWVJZCA9IG1hbnl3aG8udXRpbHMuZ2V0T2JqZWN0RGF0YVByb3BlcnR5KHRoaXMucXVldWUucHJvcGVydGllcywgdGhpcy5wYXJlbnQucGFyZW50LmdldEF0dHJpYnV0ZShcImNoaWxkS2V5QXR0cmlidXRlXCIpKS5jb250ZW50VmFsdWU7XHJcblx0XHRcdHZhciBzZWxlY3RlZFF1ZXVlSWQgPSBtYW55d2hvLnV0aWxzLmdldE9iamVjdERhdGFQcm9wZXJ0eShvYmplY3REYXRhLnByb3BlcnRpZXMsdGhpcy5wYXJlbnQucGFyZW50LmdldEF0dHJpYnV0ZShcImNoaWxkS2V5QXR0cmlidXRlXCIpKS5jb250ZW50VmFsdWU7XHJcblx0XHRcdFxyXG5cdFx0XHQvL2NvbnNvbGUubG9nKCdxaWQ9JyArIHF1ZXVlSWQpO1xyXG5cdFx0XHQvLy9jb25zb2xlLmxvZygnc2VsZWN0ZWQgcWlkPScgKyBzZWxlY3RlZFF1ZXVlSWQpO1xyXG5cdFx0XHRcclxuXHRcdFxyXG5cdFx0XHRpZihxdWV1ZUlkID09PSBzZWxlY3RlZFF1ZXVlSWQpXHJcblx0XHRcdHtcclxuXHRcdFx0XHR0aGlzLnNlbGVjdGVkID0gIHRydWU7XHJcblx0XHRcdH1cclxuXHRcdFxyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuXHR9XHJcblxyXG5cdHJlbmRlcigpXHJcblx0e1xyXG5cdFx0Y29uc3QgZmxvd1N0YXRlID0gbWFueXdoby5zdGF0ZS5nZXRDb21wb25lbnQodGhpcy5wYXJlbnQucGFyZW50LmNvbXBvbmVudElkLCAgIHRoaXMucGFyZW50LnBhcmVudC5mbG93S2V5KTtcclxuXHRcdGNvbnN0IGZsb3dNb2RlbCA9IG1hbnl3aG8ubW9kZWwuZ2V0Q29tcG9uZW50KHRoaXMucGFyZW50LnBhcmVudC5jb21wb25lbnRJZCwgICB0aGlzLnBhcmVudC5wYXJlbnQuZmxvd0tleSk7XHJcblx0XHRcclxuXHRcdGlmKGZsb3dTdGF0ZS5sb2FkaW5nKVxyXG5cdFx0e1xyXG5cdFx0XHRyZXR1cm4gbnVsbDtcclxuXHRcdH1cclxuXHRcdGVsc2VcclxuXHRcdHtcclxuICAgICAgICAgICAgXHJcblx0XHRcdHZhciBxdWV1ZUlkID0gbWFueXdoby51dGlscy5nZXRPYmplY3REYXRhUHJvcGVydHkodGhpcy5xdWV1ZS5wcm9wZXJ0aWVzLCB0aGlzLnBhcmVudC5wYXJlbnQuZ2V0QXR0cmlidXRlKFwiY2hpbGRLZXlBdHRyaWJ1dGVcIikpLmNvbnRlbnRWYWx1ZTtcclxuXHRcdFx0dmFyIHF1ZXVlTmFtZSA9IG1hbnl3aG8udXRpbHMuZ2V0T2JqZWN0RGF0YVByb3BlcnR5KHRoaXMucXVldWUucHJvcGVydGllcywgdGhpcy5wYXJlbnQucGFyZW50LmdldEF0dHJpYnV0ZShcImNoaWxkTGFiZWxBdHRyaWJ1dGVcIikpLmNvbnRlbnRWYWx1ZTtcclxuXHRcdFx0dmFyIHN1YkxhYmVsID0gbWFueXdoby51dGlscy5nZXRPYmplY3REYXRhUHJvcGVydHkodGhpcy5xdWV1ZS5wcm9wZXJ0aWVzLCB0aGlzLnBhcmVudC5wYXJlbnQuZ2V0QXR0cmlidXRlKFwiY2hpbGRTdWJMYWJlbEF0dHJpYnV0ZVwiKSkuY29udGVudFZhbHVlO1xyXG5cdFx0XHR2YXIgaWNvbiA9IG1hbnl3aG8udXRpbHMuZ2V0T2JqZWN0RGF0YVByb3BlcnR5KHRoaXMucXVldWUucHJvcGVydGllcywgdGhpcy5wYXJlbnQucGFyZW50LmdldEF0dHJpYnV0ZShcImNoaWxkSWNvbkF0dHJpYnV0ZVwiKSkuY29udGVudFZhbHVlO1xyXG5cdFx0XHRcclxuXHRcdFx0aWYoIWljb24gfHwgaWNvbi5sZW5ndGg9PT0wKVxyXG5cdFx0XHR7XHJcblx0XHRcdFx0aWNvbj0gdGhpcy5wYXJlbnQucGFyZW50LmdldEF0dHJpYnV0ZShcImNoaWxkRGVmYXVsdEljb25cIikgfHwgXCJ0YXNrc1wiO1xyXG5cdFx0XHR9XHJcblxyXG4gICAgICAgICAgICB2YXIgY2xhc3NOYW1lID0gdGhpcy5zZWxlY3RlZCA/ICd0cmVlLWxlYWYgdHJlZS1sZWFmLXNlbGVjdGVkJyA6ICd0cmVlLWxlYWYnO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvL3JldHVybiBSZWFjdC5jcmVhdGVFbGVtZW50KCAnbGknICwge3JlZjogcXVldWVJZCwgXCJkYXRhLXF1ZXVlSWRcIjogcXVldWVJZCwgY2xhc3NOYW1lOiBjbGFzc05hbWUsIG9uQ2xpY2s6IHRoaXMuc2VsZWN0IH0gLCBpdGVtcyApO1xyXG4gICAgICAgICAgICByZXR1cm4gPGxpIGNsYXNzTmFtZT0ge2NsYXNzTmFtZX0gb25DbGljaz17dGhpcy5zZWxlY3R9PlxyXG4gICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPXsnZ2x5cGhpY29uIGdseXBoaWNvbi0nICsgaWNvbn0+PC9zcGFuPlxyXG4gICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPXsncXVldWUtbGFiZWwnfT57cXVldWVOYW1lfTwvc3Bhbj5cclxuICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT17J3F1ZXVlLWNvdW50J30+e1wiKFwiICsgc3ViTGFiZWwgKyBcIilcIn08L3NwYW4+XHJcbiAgICAgICAgICAgICAgICA8L2xpPjtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICBcclxuXHR9XHJcbn1cclxuXHJcbm1hbnl3aG8uY29tcG9uZW50LnJlZ2lzdGVyKCdUcmVlVmlldycsIFRyZWVWaWV3KTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IFRyZWVWaWV3O1xyXG5cclxuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIC4vc3JjL1RyZWVWaWV3LnRzeCIsIm1vZHVsZS5leHBvcnRzID0gUmVhY3Q7XG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gZXh0ZXJuYWwgXCJSZWFjdFwiXG4vLyBtb2R1bGUgaWQgPSAyXG4vLyBtb2R1bGUgY2h1bmtzID0gMCJdLCJzb3VyY2VSb290IjoiIn0=